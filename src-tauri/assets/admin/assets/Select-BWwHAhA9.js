import{r as s,j as f}from"./index-Ba8_Z7I5.js";import{u as W,h as j,i as v,F as V,N as A}from"./Page-zRx-fbuc.js";import{useFormContext as F}from"./context-CZSQjkXQ.js";import"./index-d9iZx7WN.js";import"./index-DzTVI9Lo.js";import"./index-C2BeiomC.js";const w=({type:y,config:e,onChange:o},c)=>{var i;const[h,u]=s.useState([]),{initValues:x}=F(),[S,d]=s.useState(!0),[D,p]=s.useState(),E=W(a=>a.page.pageData.variableData);s.useEffect(()=>{var r;const a=(r=e.props.formItem)==null?void 0:r.name,t=e.props.defaultValue;x(y,a,t)},[e.props.defaultValue]),s.useEffect(()=>{typeof e.props.formWrap.disabled=="boolean"&&p(e.props.formWrap.disabled)},[e.props.formWrap.disabled]),s.useEffect(()=>{m({})},[e.api,((i=e.api)==null?void 0:i.sourceType)=="variable"?E:""]);const m=a=>{j(e.api,a).then(t=>{if((t==null?void 0:t.code)===0)if(!Array.isArray(t.data))console.error("[select]","data数据格式错误，请检查"),u([]);else{let r=[];e.props.field.label==="label"&&e.props.field.value==="value"?(r=t.data,(typeof t.data[0]=="string"||typeof t.data[0]=="number")&&(r=t.data.map(l=>({label:l,value:l})))):r=t.data.map(l=>{const b=l[e.props.field.label||"label"],n=l[e.props.field.value||"value"];return{label:v(b)?b:"-",value:v(n)?n:""}}),u(r)}})};s.useImperativeHandle(c,()=>({show(){d(!0)},hide(){d(!1)},enable(){p(!1)},disable(){p(!0)},update:a=>{m(a)}}));const I=a=>{o&&o({[e.props.formItem.name]:a})};return S&&f.jsx(V.Item,{...e.props.formItem,children:f.jsx(A,{...e.props.formWrap,disabled:D,variant:e.props.formWrap.variant||void 0,options:h,style:e.style,onChange:a=>I(a)})})},P=s.forwardRef(w);export{P as default};
