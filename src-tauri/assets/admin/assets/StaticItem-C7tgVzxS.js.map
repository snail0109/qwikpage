{"version":3,"file":"StaticItem-C7tgVzxS.js","sources":["../../../packages/materials/FormItems/StaticItem/StaticItem.tsx"],"sourcesContent":["import { Form, InputProps, FormItemProps, Image } from 'antd';\nimport { forwardRef, useEffect, useImperativeHandle, useState } from 'react';\nimport { ComponentType } from '@materials/types';\nimport dayjs from 'dayjs';\nimport { formatNumber, isNull } from '@materials/utils/util';\nimport { useFormContext } from '@materials/utils/context';\nimport { message } from '@materials/utils/AntdGlobal';\n\nexport interface IConfig {\n  defaultValue: string;\n  formItem: FormItemProps;\n  formWrap: InputProps;\n}\n\nconst StaticItem = ({ type, config }: ComponentType<IConfig>, ref: any) => {\n  const { initValues } = useFormContext();\n  const [visible, setVisible] = useState(true);\n  // 初始化默认值\n  useEffect(() => {\n    const name: string = config.props.formItem?.name;\n    const value = config.props.defaultValue;\n    initValues(type, name, value);\n  }, [config.props.defaultValue]);\n\n  useImperativeHandle(ref, () => {\n    return {\n      show() {\n        setVisible(true);\n      },\n      hide() {\n        setVisible(false);\n      },\n    };\n  });\n\n  return (\n    visible && (\n      <Form.Item {...config.props.formItem}>\n        <Label {...config.props.formWrap} name={config.props.formItem.name} style={config.style} />\n      </Form.Item>\n    )\n  );\n};\n\n// 静态文本，根据配置动态渲染各项能力\nconst Label = (props: any) => {\n  const originValue = props.value || '';\n  let value = originValue;\n  if (isNull(originValue)) {\n    // 开发模式下显示变量名称，生产模式下，需要改成{props.emptyType}\n    return <span style={props.style}>{props.emptyType}</span>;\n  }\n  if (props.showType === 'text') {\n    // 格式化日期\n    if (props.dateType) {\n      value = dayjs(originValue).format(props.dateType);\n    }\n    // 数字格式化\n    if (props.numberType) {\n      value = formatNumber(originValue, props.numberType);\n    }\n    // 如果是dayjs对象，需要转换\n    if (originValue?.format) {\n      value = dayjs(originValue).format();\n    }\n  }\n  if (props.script) {\n    try {\n      const renderFn = new Function('value', `return (${props.script})(value);`);\n      value = renderFn(value);\n    } catch (error) {\n      console.error(`脚本解析失败`, error);\n      message.error(JSON.stringify(error));\n    }\n  }\n  value = value?.toString();\n  if (props.showType === 'text') {\n    return <span style={props.style}>{value}</span>;\n  }\n  if (props.showType === 'href') {\n    return (\n      <a href={value} target=\"_blank\" style={props.style}>\n        {value}\n      </a>\n    );\n  }\n  if (props.showType === 'image') {\n    return <Image src={value} style={props.style} />;\n  }\n};\nexport default forwardRef(StaticItem);\n"],"names":["StaticItem","type","config","ref","initValues","useFormContext","visible","setVisible","useState","useEffect","name","_a","value","useImperativeHandle","Form","jsx","Label","props","originValue","isNull","dayjs","formatNumber","error","message","Image","forwardRef"],"mappings":"oQAcA,MAAMA,EAAa,CAAC,CAAE,KAAAC,EAAM,OAAAC,CAAA,EAAkCC,IAAa,CACnE,KAAA,CAAE,WAAAC,CAAW,EAAIC,EAAe,EAChC,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAI,EAE3CC,OAAAA,EAAAA,UAAU,IAAM,OACR,MAAAC,GAAeC,EAAAT,EAAO,MAAM,WAAb,YAAAS,EAAuB,KACtCC,EAAQV,EAAO,MAAM,aAChBE,EAAAH,EAAMS,EAAME,CAAK,CAC3B,EAAA,CAACV,EAAO,MAAM,YAAY,CAAC,EAE9BW,EAAA,oBAAoBV,EAAK,KAChB,CACL,MAAO,CACLI,EAAW,EAAI,CACjB,EACA,MAAO,CACLA,EAAW,EAAK,CAAA,CAEpB,EACD,EAGCD,SACGQ,EAAK,KAAL,CAAW,GAAGZ,EAAO,MAAM,SAC1B,SAACa,EAAAA,IAAAC,EAAA,CAAO,GAAGd,EAAO,MAAM,SAAU,KAAMA,EAAO,MAAM,SAAS,KAAM,MAAOA,EAAO,KAAA,CAAO,CAC3F,CAAA,CAGN,EAGMc,EAASC,GAAe,CACtB,MAAAC,EAAcD,EAAM,OAAS,GACnC,IAAIL,EAAQM,EACR,GAAAC,EAAOD,CAAW,EAEpB,aAAQ,OAAK,CAAA,MAAOD,EAAM,MAAQ,WAAM,UAAU,EAgBpD,GAdIA,EAAM,WAAa,SAEjBA,EAAM,WACRL,EAAQQ,EAAMF,CAAW,EAAE,OAAOD,EAAM,QAAQ,GAG9CA,EAAM,aACAL,EAAAS,EAAaH,EAAaD,EAAM,UAAU,GAGhDC,GAAA,MAAAA,EAAa,SACPN,EAAAQ,EAAMF,CAAW,EAAE,OAAO,IAGlCD,EAAM,OACJ,GAAA,CAEFL,EADiB,IAAI,SAAS,QAAS,WAAWK,EAAM,MAAM,WAAW,EACxDL,CAAK,QACfU,EAAO,CACN,QAAA,MAAM,SAAUA,CAAK,EAC7BC,EAAQ,MAAM,KAAK,UAAUD,CAAK,CAAC,CAAA,CAInC,GADJV,EAAQA,GAAA,YAAAA,EAAO,WACXK,EAAM,WAAa,OACrB,OAAQF,EAAA,IAAA,OAAA,CAAK,MAAOE,EAAM,MAAQ,SAAML,EAAA,EAEtC,GAAAK,EAAM,WAAa,OAEnB,OAAAF,EAAA,IAAC,KAAE,KAAMH,EAAO,OAAO,SAAS,MAAOK,EAAM,MAC1C,SACHL,CAAA,CAAA,EAGA,GAAAK,EAAM,WAAa,QACrB,aAAQO,EAAM,CAAA,IAAKZ,EAAO,MAAOK,EAAM,MAAO,CAElD,EACeQ,EAAAA,EAAAA,WAAWzB,CAAU"}