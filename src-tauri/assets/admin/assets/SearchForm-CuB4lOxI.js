import{r as i,j as t,B as d,R as O}from"./index-Ba8_Z7I5.js";import{F as V,u as W,a as m,i as _,g as q,b as z,d as G,M as J,x as K,m as Q}from"./Page-zRx-fbuc.js";import{i as U}from"./index-D8fqk8iM.js";import{FormContext as X}from"./context-CZSQjkXQ.js";import D from"./index.module-BHwNohRk.js";import{b as Y,c as Z,d as ee}from"./index-d9iZx7WN.js";import{R as se}from"./RedoOutlined-ZyqLJpQf.js";import"./index-DzTVI9Lo.js";import"./index-C2BeiomC.js";import"./MinusOutlined-CM_AhdfL.js";const te=({id:l,type:ae,config:c,elements:n,onSearch:x,onChange:f,onReset:h},k)=>{var R;const[o]=V.useForm(),F=i.useRef(null),[p,I]=i.useState(!1),[S,j]=i.useState(!1),[E,y]=i.useState(!0),[N,T]=i.useState({}),{formData:g,setFormData:u}=W(e=>({formData:e.page.pageData.formData,setFormData:e.setFormData}));i.useEffect(()=>{setTimeout(()=>{var e;((e=F.current)==null?void 0:e.offsetTop)>=32&&n.length>0?j(!0):j(!1)},500)},[n]);const A=()=>{const e=o.getFieldsValue();x&&x(m(n,e))},L=()=>{o.resetFields();const e=o.getFieldsValue();h&&h(m(n,e)),u({name:l,value:e,type:"override"})},P=(e,s)=>{const a=m(n,s);f==null||f(a),u({name:l,value:a})};i.useImperativeHandle(k,()=>({show(){y(!0)},hide(){y(!1)},reset(){o.resetFields(),u({name:l,value:o.getFieldsValue(),type:"override"})},submit(){o.submit()},init(e={}){const s=m(n,e);o.setFieldsValue(s),u({name:l,value:s})},getFormData(e){var s;return e&&typeof e=="string"?(s=g[l])==null?void 0:s[e]:g[l]}}));const $=e=>{const s=o.getFieldsValue(),a=m(n,s),r=c.events.find(H=>H.eventName===e);Q(r==null?void 0:r.actions,a)},w=()=>{I(!p)},{submitText:v,resetText:b}=c.props.form||{},B=c.props.bulkActionList||[],C=i.useCallback((e,s,a)=>{if(s&&_(a)){let r=a;e==="InputNumber"&&(r=Number(a)),e==="DatePicker"&&(r=q(a)),e==="DatePickerRange"&&(r=z(a)),e==="TimePicker"&&(r=G(a,"HH:mm:ss")),T({[s]:r}),o.setFieldValue([s],r),u({name:l,value:{[s]:r}})}},[]),M=U;return E&&t.jsx(X.Provider,{value:{initValues:C},children:t.jsxs(V,{form:o,layout:"inline",style:c.style,initialValues:N,onValuesChange:P,children:[t.jsxs("div",{className:D.formWrap,style:p?{}:{height:32,overflow:"hidden"},children:[t.jsx(J,{elements:n}),t.jsx("div",{ref:F})]}),t.jsxs(K,{style:{alignItems:"baseline",marginLeft:10},children:[v?t.jsx(d,{type:"primary",icon:t.jsx(Y,{}),onClick:A,children:v}):null,b?t.jsx(d,{type:"default",icon:t.jsx(se,{}),onClick:L,children:b}):null,B.length>0&&t.jsx("div",{className:D.action,children:(R=c.props.bulkActionList)==null?void 0:R.map((e,s)=>t.jsx(d,{type:e.type,danger:e.danger,icon:e.icon?O.createElement(M[e.icon]):null,onClick:()=>$(e.eventName),children:e.text},`bulkAction${s}`))}),S&&t.jsx(d,{type:"link",icon:p?t.jsx(Z,{}):t.jsx(ee,{}),onClick:w,children:p?"收起":"展开"})]})]})})},fe=i.forwardRef(te);export{fe as default};
