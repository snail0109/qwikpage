{"version":3,"file":"Radio-Dn5QxQtv.js","sources":["../../../packages/materials/FormItems/Radio/Radio.tsx"],"sourcesContent":["import { ComponentType } from '@materials/types';\nimport { Form, Radio, FormItemProps, RadioProps } from 'antd';\nimport { forwardRef, useEffect, useImperativeHandle, useState } from 'react';\nimport { handleApi } from '@materials/utils/handleApi';\nimport { isNotEmpty, isNull } from '@materials/utils/util';\nimport { useFormContext } from '@materials/utils/context';\nimport { usePageStore } from '@materials/stores/pageStore';\n\n/* 泛型只需要定义组件本身用到的属性，当然也可以不定义，默认为any */\nexport interface IConfig {\n  defaultValue: string;\n  formItem: FormItemProps;\n  formWrap: RadioProps;\n  field: {\n    label: string;\n    value: string;\n  };\n  source: Array<{ label: string; value: any }>;\n}\n/**\n *\n * @param config 组件配置属性值\n * @param props 系统属性值：componentid、componentname等\n * @returns 返回组件\n */\nconst MRadio = ({ type, config, onChange }: ComponentType<IConfig>, ref: any) => {\n  const [data, setData] = useState<Array<{ label: string; value: any }>>([]);\n  const { initValues } = useFormContext();\n  const [visible, setVisible] = useState(true);\n  const [disabled, setDisabled] = useState<boolean | undefined>();\n  const variableData = usePageStore((state) => state.page.pageData.variableData);\n  // 初始化默认值\n  useEffect(() => {\n    const name: string = config.props.formItem?.name;\n    const value = config.props.defaultValue;\n    initValues(type, name, value);\n  }, [config.props.defaultValue]);\n\n  // 启用和禁用\n  useEffect(() => {\n    if (typeof config.props.formWrap.disabled === 'boolean') setDisabled(config.props.formWrap.disabled);\n  }, [config.props.formWrap.disabled]);\n\n  useEffect(() => {\n    getDataList({});\n  }, [config.api, config.api?.sourceType == 'variable' ? variableData : '']);\n\n  // 列表加载\n  const getDataList = (data: any) => {\n    handleApi(config.api, data).then((res) => {\n      if (res?.code === 0) {\n        if (!Array.isArray(res.data)) {\n          console.error('[radio]', 'data数据格式错误，请检查');\n          setData([]);\n        } else {\n          // 判断是否需要做数据转换\n          let options = [];\n          if (config.props.field.label === 'label' && config.props.field.value === 'value') {\n            options = res.data;\n            if (typeof res.data[0] === 'string' || typeof res.data[0] === 'number') {\n              options = res.data.map((item: string | number) => {\n                return { label: item, value: item };\n              });\n            }\n          } else {\n            options = res.data.map((item: any) => {\n              const label = item[config.props.field.label || 'label'];\n              const value = item[config.props.field.value || 'value'];\n              return {\n                label: isNotEmpty(label) ? label : '-',\n                value: isNotEmpty(value) ? value : '',\n              };\n            });\n          }\n          setData(options);\n        }\n      }\n    });\n  };\n\n  useImperativeHandle(ref, () => {\n    return {\n      show() {\n        setVisible(true);\n      },\n      hide() {\n        setVisible(false);\n      },\n      enable() {\n        setDisabled(false);\n      },\n      disable() {\n        setDisabled(true);\n      },\n      update: (data: any) => {\n        // 重新加载表格数据\n        getDataList(data);\n      },\n    };\n  });\n\n  const handleChange = (val: any) => {\n    onChange?.({\n      [config.props.formItem.name]: val,\n    });\n  };\n\n  return (\n    visible && (\n      <Form.Item {...config.props.formItem}>\n        <Radio.Group\n          {...config.props.formWrap}\n          disabled={disabled}\n          options={data}\n          style={config.style}\n          onChange={(event) => handleChange(event.target.value)}\n        />\n      </Form.Item>\n    )\n  );\n};\nexport default forwardRef(MRadio);\n"],"names":["MRadio","type","config","onChange","ref","data","setData","useState","initValues","useFormContext","visible","setVisible","disabled","setDisabled","variableData","usePageStore","state","useEffect","name","_a","value","getDataList","handleApi","res","options","item","label","isNotEmpty","useImperativeHandle","handleChange","val","Form","jsx","Radio","event","forwardRef"],"mappings":"6PAyBA,MAAMA,EAAS,CAAC,CAAE,KAAAC,EAAM,OAAAC,EAAQ,SAAAC,CAAA,EAAoCC,IAAa,OAC/E,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAA+C,CAAA,CAAE,EACnE,CAAE,WAAAC,CAAW,EAAIC,EAAe,EAChC,CAACC,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAI,EACrC,CAACK,EAAUC,CAAW,EAAIN,WAA8B,EACxDO,EAAeC,EAAcC,GAAUA,EAAM,KAAK,SAAS,YAAY,EAE7EC,EAAAA,UAAU,IAAM,OACR,MAAAC,GAAeC,EAAAjB,EAAO,MAAM,WAAb,YAAAiB,EAAuB,KACtCC,EAAQlB,EAAO,MAAM,aAChBM,EAAAP,EAAMiB,EAAME,CAAK,CAC3B,EAAA,CAAClB,EAAO,MAAM,YAAY,CAAC,EAG9Be,EAAAA,UAAU,IAAM,CACV,OAAOf,EAAO,MAAM,SAAS,UAAa,WAAuBW,EAAAX,EAAO,MAAM,SAAS,QAAQ,GAClG,CAACA,EAAO,MAAM,SAAS,QAAQ,CAAC,EAEnCe,EAAAA,UAAU,IAAM,CACdI,EAAY,CAAA,CAAE,CAAA,EACb,CAACnB,EAAO,MAAKiB,EAAAjB,EAAO,MAAP,YAAAiB,EAAY,aAAc,WAAaL,EAAe,EAAE,CAAC,EAGnE,MAAAO,EAAehB,GAAc,CACjCiB,EAAUpB,EAAO,IAAKG,CAAI,EAAE,KAAMkB,GAAQ,CACpC,IAAAA,GAAA,YAAAA,EAAK,QAAS,EAChB,GAAI,CAAC,MAAM,QAAQA,EAAI,IAAI,EACjB,QAAA,MAAM,UAAW,gBAAgB,EACzCjB,EAAQ,CAAA,CAAE,MACL,CAEL,IAAIkB,EAAU,CAAC,EACXtB,EAAO,MAAM,MAAM,QAAU,SAAWA,EAAO,MAAM,MAAM,QAAU,SACvEsB,EAAUD,EAAI,MACV,OAAOA,EAAI,KAAK,CAAC,GAAM,UAAY,OAAOA,EAAI,KAAK,CAAC,GAAM,YAC5DC,EAAUD,EAAI,KAAK,IAAKE,IACf,CAAE,MAAOA,EAAM,MAAOA,CAAK,EACnC,IAGHD,EAAUD,EAAI,KAAK,IAAKE,GAAc,CACpC,MAAMC,EAAQD,EAAKvB,EAAO,MAAM,MAAM,OAAS,OAAO,EAChDkB,EAAQK,EAAKvB,EAAO,MAAM,MAAM,OAAS,OAAO,EAC/C,MAAA,CACL,MAAOyB,EAAWD,CAAK,EAAIA,EAAQ,IACnC,MAAOC,EAAWP,CAAK,EAAIA,EAAQ,EACrC,CAAA,CACD,EAEHd,EAAQkB,CAAO,CAAA,CAEnB,CACD,CACH,EAEAI,EAAA,oBAAoBxB,EAAK,KAChB,CACL,MAAO,CACLO,EAAW,EAAI,CACjB,EACA,MAAO,CACLA,EAAW,EAAK,CAClB,EACA,QAAS,CACPE,EAAY,EAAK,CACnB,EACA,SAAU,CACRA,EAAY,EAAI,CAClB,EACA,OAASR,GAAc,CAErBgB,EAAYhB,CAAI,CAAA,CAEpB,EACD,EAEK,MAAAwB,EAAgBC,GAAa,CACtB3B,GAAA,MAAAA,EAAA,CACT,CAACD,EAAO,MAAM,SAAS,IAAI,EAAG4B,CAAA,EAElC,EAGE,OAAApB,SACGqB,EAAK,KAAL,CAAW,GAAG7B,EAAO,MAAM,SAC1B,SAAA8B,EAAA,IAACC,EAAM,MAAN,CACE,GAAG/B,EAAO,MAAM,SACjB,SAAAU,EACA,QAASP,EACT,MAAOH,EAAO,MACd,SAAWgC,GAAUL,EAAaK,EAAM,OAAO,KAAK,CAAA,CAAA,EAExD,CAGN,EACeC,EAAAA,EAAAA,WAAWnC,CAAM"}