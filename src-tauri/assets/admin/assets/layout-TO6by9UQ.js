import{a as M,u as b,r as f,j as e,c as C,R as w,C as N,O as k}from"./index-CrRWnIjq.js";import{u as v,g as L,a as A}from"./util-Bnlu7up1.js";import{u as R,B as D,M as O,F as S,a as H,L as I,f as J,h as K}from"./index-BFS5rlf2.js";import{i as W,R as X,a as Y}from"./index-B1Ox7m8n.js";import{l as G}from"./zh-cn-Dhibfpyy.js";import"./index-BCFTpXN0.js";import"./MinusOutlined-BsLWaGMW.js";import"./RedoOutlined-B-c2Dsb9.js";const Q="_logo_145u9_1",U="_logoName_145u9_14",T={logo:Q,logoName:U};function $(){const{collapsed:o,projectInfo:t}=v(),n=M(),{projectId:i}=b(),[r,u]=f.useState({}),[a,m]=f.useState({});return f.useEffect(()=>{t.menuThemeColor==="dark"?u({backgroundColor:"#001529",color:"#fff",height:64,padding:"10px 20px"}):u({backgroundColor:"#fff",color:"#000",height:64,padding:"10px 20px"}),/^[\u4e00-\u9fa5]+$/.test(t.name)&&m({fontSize:t.name.length>9?14:16})},[t.layout,t.menuThemeColor]),e.jsxs("div",{className:T.logo,onClick:()=>{n(`/project/${i}/welcome`)},style:r,children:[e.jsx("img",{src:t.logo||"/imgs/mars-logo.png"}),!o&&e.jsx("span",{className:T.logoName,style:a,children:t.name})]})}function z(){const{projectId:o}=b(),[t,n]=f.useState([]),{pathname:i}=C(),{pageMap:r,menuMap:u}=v(R(a=>({pageMap:a.pageMap,menuMap:a.menuMap})));return f.useEffect(()=>{if(!o)return;const a=i.split(o)[1].slice(1),m=L(a,r);if(!m)return;const h=r[m];if(i.endsWith("/welcome")){n([{title:"欢迎页"}]);return}if(!h)return;const p=[];let g=h;for(;g;)p.unshift({title:g.name}),g=u[g.parentId];n(p)},[i,u]),e.jsx(D,{className:"layout-bread-crumb",items:t})}const B=()=>{const[o,t]=f.useState([]),[n,i]=f.useState([]),r=M(),{pathname:u}=C(),{projectId:a}=b(),{collapsed:m,menuTree:h,projectInfo:p}=v();f.useEffect(()=>{const l=g(h);t(l)},[h]),f.useEffect(()=>{i([u])},[u]);const g=(l,d=[])=>(l.forEach(s=>{var j;if(s.menuType===1&&s.status===1){const y=W;if((j=s.buttons)!=null&&j.length||!s.children){const q=`/project/${a}/${s.path&&s.path.startsWith("/")?s.path.slice(1):s.path||s.pageId}`;return d.push(x(s.name,q,y[s.icon]&&w.createElement(y[s.icon])))}const F=`${a}-${s.id}`;d.push(x(s.name,F,y[s.icon]&&w.createElement(y[s.icon]),g(s.children||[])))}}),d);function x(l,d,s,j,y){return(j==null?void 0:j.length)===0&&(j=void 0),{key:d,icon:s,children:j,label:l,type:y}}const c=l=>{const d=l.key;u!==d&&(l.key.split("/").slice(-1)[0]==="0"?r("notPublish"):r(d))};return e.jsx("div",{style:p.menuMode==="horizontal"?{width:"calc(100vw - 458px)"}:{width:m?79:255,background:p.menuThemeColor==="light"?"#fff":"#001529",borderRight:p.layout===2?"1px solid #e8e9eb":"none",overflowX:"hidden"},children:e.jsx(N,{theme:{components:{Menu:{darkItemColor:"#fff",darkItemHoverColor:p.systemThemeColor,iconSize:16}}},children:e.jsx(O,{onClick:c,theme:p.menuThemeColor,selectedKeys:n,style:p.menuMode==="horizontal"?{}:{height:"calc(100vh - 64px)",border:"none",overflowY:"auto"},mode:p.menuMode,inlineCollapsed:p.menuMode==="horizontal"?void 0:m,items:o})})})},V="_header_1imqu_1",Z="_menu_1imqu_16",ee="_user_1imqu_22",te="_publishPopover_1imqu_26",oe={header:V,menu:Z,user:ee,publishPopover:te},P=f.memo(()=>{const{projectInfo:o,collapsed:t,updateCollapsed:n}=v(),i=()=>{n()},r=o.menuThemeColor==="light"||o.layout===1,u={backgroundColor:r?"#fff":"#001529",color:o.menuThemeColor==="light"?"#000":"#fff"};return e.jsxs("div",{className:oe.header,style:u,children:[o.layout===1?e.jsxs(S,{align:"center",children:[e.jsx("div",{onClick:i,style:{cursor:"pointer"},children:t?e.jsx(X,{style:{color:r?"#000":"#fff"}}):e.jsx(Y,{style:{color:r?"#000":"#fff"}})}),o.breadcrumb&&e.jsx(z,{})]}):null,o.layout===2?e.jsxs(S,{align:"center",children:[e.jsx($,{}),e.jsx(B,{})]}):null]})});function _(){const o=M(),[t,n]=f.useState([{label:"欢迎页",key:"welcome",closable:!1}]),[i,r]=f.useState(""),{projectId:u}=b(),{pathname:a}=C(),m=v(R(c=>c.pageMap));f.useEffect(()=>{h()},[a,m]);const h=()=>{if(!u)return;const c=a.split(u)[1].slice(1),l=L(c,m),d=m[l];d&&(t.find(s=>s.key.includes(a))||t.push({key:a+location.search,label:d.name,closable:!0}),n([...t]),r(a+location.search))},p=c=>{a===c&&t.forEach((l,d)=>{if(l.key!=a)return;const s=t[d+1]||t[d-1];s&&o(s.key)}),n(t.filter(l=>l.key!=c))},g=c=>{p(c)},x=c=>{if(r(c),c==="welcome")return o("welcome");o(c)};return e.jsx(H,{type:"editable-card",hideAdd:!0,activeKey:i,items:t,onChange:x,onEdit:g,tabBarStyle:{marginBottom:0,backgroundColor:"#fff",paddingTop:10}})}const E={set(o,t){localStorage.setItem(o,JSON.stringify(t))},get(o){const t=localStorage.getItem(o);if(!t)return"";try{return JSON.parse(t)}catch{return""}},remove(o){localStorage.removeItem(o)},clear(){localStorage.clear()}},pe=()=>{const{collapsed:o,setProjectInfo:t,projectInfo:n}=v(h=>({collapsed:h.collapsed,setProjectInfo:h.setProjectInfo,projectInfo:h.projectInfo})),i=M(),{projectId:r}=b(),{pathname:u}=C();f.useEffect(()=>{(async()=>{if(r){const p=await J(r).catch(()=>i("/403?type=project"));if(!p.id)return i("/404?type=project");const g=await K(r).catch(()=>i("/403?type=project"));if(!g)return;/project\/\d+\/\w+/.test(u)||i(`/project/${r}/welcome`);const{menuTree:x,buttons:c,pageMap:l,menuMap:d}=A(g||[]);E.set("buttons",c),E.set("pageMap",l),t({projectInfo:p,menuTree:x,buttons:c,pageMap:l,menuMap:d})}})()},[r]);const a=f.useMemo(()=>n.tag?"calc(100vh - 114px)":"calc(100vh - 64px)",[n.tag]),m=()=>e.jsx(I.Footer,{children:e.jsx("div",{className:"footnote",children:e.jsx("span",{children:"Copyright © 2024 Marsview. All Rights Reserved. "})})});return e.jsx(N,{locale:G,theme:{token:{colorPrimary:n.systemThemeColor||"#1677ff"},hashed:!1},children:e.jsxs(I,{children:[n.layout===1&&e.jsxs(I,{style:{flexDirection:"row"},children:[e.jsxs("div",{style:{width:o?80:256,borderRight:"1px solid #e8e9eb"},children:[e.jsx($,{}),e.jsx(B,{})]}),e.jsxs("div",{style:{width:o?"calc(100vw - 80px)":"calc(100vw - 256px)"},children:[e.jsx(P,{}),n.tag&&e.jsx(_,{}),e.jsxs("div",{style:{height:a,overflow:"auto"},children:[e.jsx(k,{}),n.footer===1&&e.jsx(m,{})]})]})]}),n.layout===2&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),n.tag?e.jsx(_,{}):null,e.jsxs(I,{style:{padding:20,backgroundColor:"#f3f5f9",height:a,overflow:"auto"},children:[n.breadcrumb&&e.jsx(z,{}),e.jsx(k,{}),n.footer===1&&e.jsx(m,{})]})]})]})})};export{pe as default};
//# sourceMappingURL=layout-TO6by9UQ.js.map
