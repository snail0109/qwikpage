{"version":3,"file":"AuthButton-BAPOJ_KH.js","sources":["../../../packages/materials/Functional/Button/AuthButton.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { Button } from 'antd';\nimport storage from '@materials/utils/storage';\nimport { useLocation, useParams } from 'react-router-dom';\nimport { renderFormula, getPageId } from '@materials/utils/util';\n\nconst renderBtn = (props: any) => (<Button {...props} onClick={props.onClick}>\n  {props.children}\n</Button>);\n/**\n * 按钮权限控制\n */\nexport default function AuthButton({ authCode, authScript, ...props }: any) {\n  const [newAuthCode, setNewAuthCode] = useState('');\n  const [buttons, setButtons] = useState([]);\n  const { projectId, id } = useParams();\n  const { pathname } = useLocation();\n\n  useEffect(() => {\n    if (!projectId || !authCode) return;\n    const btns = storage.get('buttons') || [];\n    const pageMap = storage.get('pageMap');\n    setButtons(btns);\n    const pageId = pathname.split(projectId)[1].slice(1);\n    // 获取页面ID\n    const id = getPageId(pageId, pageMap);\n    const code = projectId + '_' + id + '_' + authCode;\n    setNewAuthCode(code);\n  }, [pathname, authCode]);\n\n  // 渲染按钮\n  const renderBtn = (props: any) => (\n    <Button {...props} onClick={props.onClick}>\n      {props.children}\n    </Button>\n  );\n  /**\n   * 1. 如果没有配置权限，则直接显示按钮\n   * 2. 如果是页面打开，并且不是微服务环境，则直接显示按钮\n   * 3. 如果是项目打开，则判断是否配置了权限，根据权限进行查找，命中则显示按钮，否则不显示\n   */\n  if (!authCode || (id && !window.microApp) || (projectId && authCode && buttons.find((b: any) => b.code === newAuthCode))) {\n    return renderBtn(props);\n  }\n  /**\n   * 如果页面打开，并且authScript有值，说明是跨服务权限判断\n   */\n  if (authScript && id) {\n    const isTrue = renderFormula(authScript.value, { authCode });\n    return isTrue ? renderBtn(props) : null;\n  }\n  return null;\n}\n/**\n * 生成按钮，当权限不符合时，不需要占位符\n * @param param0 \n * @returns \n */\nexport const genAuthButton = ({ authCode, authScript, ...props }: any) => {\n  const { projectId, pageId, id } = useParams();\n  const buttons = storage.get('buttons') || [];\n  const pageMap = storage.get('pageMap');\n  const newAuthCode = projectId + '_' + pageMap[Number(pageId)]?.id + '_' + authCode;\n  /**\n   * 1. 如果没有配置权限，则直接显示按钮\n   * 2. 如果是页面打开，并且不是微服务环境，则直接显示按钮\n   * 3. 如果是项目打开，则判断是否配置了权限，根据权限进行查找，命中则显示按钮，否则不显示\n   */\n  if (!authCode || (id && !window.microApp) || (projectId && authCode && buttons.find((b: any) => b.code === newAuthCode))) {\n    return renderBtn(props);\n  }\n  /**\n   * 如果页面打开，并且authScript有值，说明是跨服务权限判断\n   */\n  if (authScript && id) {\n    const isTrue = renderFormula(authScript.value, { authCode });\n    return isTrue ? renderBtn(props) : null;\n  }\n  return null;\n};"],"names":["renderBtn","props","jsx","Button","AuthButton","authCode","authScript","newAuthCode","setNewAuthCode","useState","buttons","setButtons","projectId","id","useParams","pathname","useLocation","useEffect","btns","storage","pageMap","pageId","getPageId","code","b","renderFormula","genAuthButton","_a"],"mappings":"6MAMA,MAAMA,EAAaC,GAAiBC,MAAAC,EAAA,CAAQ,GAAGF,EAAO,QAASA,EAAM,QAClE,SAAAA,EAAM,QACT,CAAA,EAIA,SAAwBG,EAAW,CAAE,SAAAC,EAAU,WAAAC,EAAY,GAAGL,GAAc,CAC1E,KAAM,CAACM,EAAaC,CAAc,EAAIC,EAAAA,SAAS,EAAE,EAC3C,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,CAAA,CAAE,EACnC,CAAE,UAAAG,EAAW,GAAAC,CAAG,EAAIC,EAAU,EAC9B,CAAE,SAAAC,CAAS,EAAIC,EAAY,EAEjCC,EAAAA,UAAU,IAAM,CACV,GAAA,CAACL,GAAa,CAACP,EAAU,OAC7B,MAAMa,EAAOC,EAAQ,IAAI,SAAS,GAAK,CAAC,EAClCC,EAAUD,EAAQ,IAAI,SAAS,EACrCR,EAAWO,CAAI,EACT,MAAAG,EAASN,EAAS,MAAMH,CAAS,EAAE,CAAC,EAAE,MAAM,CAAC,EAE7CC,EAAKS,EAAUD,EAAQD,CAAO,EAC9BG,EAAOX,EAAY,IAAMC,EAAK,IAAMR,EAC1CG,EAAee,CAAI,CAAA,EAClB,CAACR,EAAUV,CAAQ,CAAC,EAGvB,MAAML,EAAaC,GACjBC,EAAAA,IAACC,EAAQ,CAAA,GAAGF,EAAO,QAASA,EAAM,QAC/B,SAAAA,EAAM,QACT,CAAA,EAOF,MAAI,CAACI,GAAaQ,GAAM,CAAC,OAAO,UAAcD,GAAaP,GAAYK,EAAQ,KAAMc,GAAWA,EAAE,OAASjB,CAAW,GAMlHD,GAAcO,GACDY,EAAcnB,EAAW,MAAO,CAAE,SAAAD,EAAU,EANpDL,EAAUC,CAAK,EASjB,IACT,CAMO,MAAMyB,EAAgB,CAAC,CAAE,SAAArB,EAAU,WAAAC,EAAY,GAAGL,KAAiB,OACxE,KAAM,CAAE,UAAAW,EAAW,OAAAS,EAAQ,GAAAR,CAAA,EAAOC,EAAU,EACtCJ,EAAUS,EAAQ,IAAI,SAAS,GAAK,CAAC,EACrCC,EAAUD,EAAQ,IAAI,SAAS,EAC/BZ,EAAcK,EAAY,MAAMe,EAAAP,EAAQ,OAAOC,CAAM,CAAC,IAAtB,YAAAM,EAAyB,IAAK,IAAMtB,EAM1E,MAAI,CAACA,GAAaQ,GAAM,CAAC,OAAO,UAAcD,GAAaP,GAAYK,EAAQ,KAAMc,GAAWA,EAAE,OAASjB,CAAW,GAMlHD,GAAcO,GACDY,EAAcnB,EAAW,MAAO,CAAE,SAAAD,EAAU,EANpDL,EAAUC,CAAK,EASjB,IACT"}