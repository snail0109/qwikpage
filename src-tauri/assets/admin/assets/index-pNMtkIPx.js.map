{"version":3,"file":"index-pNMtkIPx.js","sources":["../../../packages/admin/src/pages/project/notFound.tsx","../../../packages/admin/src/pages/project/index.tsx"],"sourcesContent":["import { Result, Button } from 'antd';\nimport { useNavigate, useParams } from 'react-router-dom';\nfunction NotFound() {\n  const navigate = useNavigate();\n  const { projectId } = useParams();\n  const handleBack = () => {\n    navigate(`/project/${projectId}/welcome`);\n  };\n  return (\n    <Result\n      status={404}\n      title=\"页面不存在或未发布\"\n      subTitle=\"当前页面路径不存在，请检查路由地址是否正确或页面是否发布\"\n      extra={\n        <Button type=\"primary\" onClick={handleBack}>\n          返回首页\n        </Button>\n      }\n    />\n  );\n}\n\nexport default NotFound;\n","import { getPageDetail } from '@/api/index';\nimport { useLocation, useParams } from 'react-router-dom';\nimport { useEffect, useState } from 'react';\nimport { usePageStore } from '@marsview/materials/stores/pageStore';\nimport { useProjectStore } from '@/stores/projectStore';\nimport { message } from '@/utils/AntdGlobal';\nimport NotFound from './notFound';\nimport Page from '@marsview/materials/Page/Page';\nimport { useShallow } from 'zustand/react/shallow';\nimport { ComItemType, ConfigType } from '@marsview/materials/types/index';\nimport { getPageId } from '@/utils/util';\n\nexport default function () {\n  const [pageData, setPageData] = useState<{ config: ConfigType; elements: ComItemType[] }>();\n  const [notFound, setNotFound] = useState(false);\n\n  const { projectId } = useParams();\n\n  const { initPageData, savePageInfo, clearPageInfo } = usePageStore(\n    useShallow((state) => {\n      return {\n        initPageData: state.page.pageData,\n        savePageInfo: state.savePageInfo,\n        clearPageInfo: state.clearPageInfo,\n      };\n    }),\n  );\n  const pageMap = useProjectStore(useShallow((state) => state.pageMap));\n  const { pathname } = useLocation();\n  useEffect(() => {\n    if (!projectId) return;\n    const pageId = pathname.split(projectId)[1].slice(1);\n    // 获取页面ID\n    const id = getPageId(pageId, pageMap);\n    if (!pageMap[id] || !id) {\n      setNotFound(true);\n      return;\n    }\n    getPageDetail(id)\n      .then((res: any) => {\n        let pageData: any = {};\n        try {\n          pageData = JSON.parse(res.pageData || '{}');\n        } catch (error) {\n          console.error(error);\n          console.info('【json数据】', res.pageData);\n          message.error('页面数据格式错误，请检查');\n        }\n        clearPageInfo();\n        savePageInfo({\n          ...res,\n          pageData,\n        });\n        setPageData(pageData);\n        setNotFound(false);\n      })\n      .catch(() => {\n        setNotFound(true);\n      });\n    return () => {\n      setPageData({ config: initPageData.config, elements: [] });\n    };\n  }, [projectId, pathname]);\n\n  return <>{notFound ? <NotFound /> : <Page config={pageData?.config} elements={pageData?.elements} />}</>;\n}\n"],"names":["NotFound","navigate","useNavigate","projectId","useParams","handleBack","jsx","Result","Button","index","pageData","setPageData","useState","notFound","setNotFound","initPageData","savePageInfo","clearPageInfo","usePageStore","useShallow","state","pageMap","useProjectStore","pathname","useLocation","useEffect","pageId","id","getPageId","getPageDetail","res","error","message","Fragment","Page"],"mappings":"iSAEA,SAASA,GAAW,CAClB,MAAMC,EAAWC,EAAY,EACvB,CAAE,UAAAC,CAAU,EAAIC,EAAU,EAC1BC,EAAa,IAAM,CACdJ,EAAA,YAAYE,CAAS,UAAU,CAC1C,EAEE,OAAAG,EAAA,IAACC,EAAA,CACC,OAAQ,IACR,MAAM,YACN,SAAS,+BACT,MACGD,EAAAA,IAAAE,EAAA,CAAO,KAAK,UAAU,QAASH,EAAY,SAE5C,MAAA,CAAA,CAAA,CAEJ,CAEJ,CCR2B,SAAAI,GAAA,CACzB,KAAM,CAACC,EAAUC,CAAW,EAAIC,WAA0D,EACpF,CAACC,EAAUC,CAAW,EAAIF,EAAAA,SAAS,EAAK,EAExC,CAAE,UAAAT,CAAU,EAAIC,EAAU,EAE1B,CAAE,aAAAW,EAAc,aAAAC,EAAc,cAAAC,CAAkB,EAAAC,EACpDC,EAAYC,IACH,CACL,aAAcA,EAAM,KAAK,SACzB,aAAcA,EAAM,aACpB,cAAeA,EAAM,aACvB,EACD,CACH,EACMC,EAAUC,EAAgBH,EAAYC,GAAUA,EAAM,OAAO,CAAC,EAC9D,CAAE,SAAAG,CAAS,EAAIC,EAAY,EACjCC,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAI,CAACtB,EAAW,OACV,MAAAuB,EAASH,EAAS,MAAMpB,CAAS,EAAE,CAAC,EAAE,MAAM,CAAC,EAE7CwB,EAAKC,EAAUF,EAAQL,CAAO,EACpC,GAAI,CAACA,EAAQM,CAAE,GAAK,CAACA,EAAI,CACvBb,EAAY,EAAI,EAChB,MAAA,CAEF,OAAAe,EAAcF,CAAE,EACb,KAAMG,GAAa,CAClB,IAAIpB,EAAgB,CAAC,EACjB,GAAA,CACFA,EAAW,KAAK,MAAMoB,EAAI,UAAY,IAAI,QACnCC,EAAO,CACd,QAAQ,MAAMA,CAAK,EACX,QAAA,KAAK,WAAYD,EAAI,QAAQ,EACrCE,EAAQ,MAAM,cAAc,CAAA,CAEhBf,EAAA,EACDD,EAAA,CACX,GAAGc,EACH,SAAApB,CAAA,CACD,EACDC,EAAYD,CAAQ,EACpBI,EAAY,EAAK,CAAA,CAClB,EACA,MAAM,IAAM,CACXA,EAAY,EAAI,CAAA,CACjB,EACI,IAAM,CACXH,EAAY,CAAE,OAAQI,EAAa,OAAQ,SAAU,CAAA,EAAI,CAC3D,CAAA,EACC,CAACZ,EAAWoB,CAAQ,CAAC,EAEdjB,EAAA,IAAA2B,EAAA,SAAA,CAAA,SAAApB,EAAYP,MAAAN,EAAA,CAAA,CAAS,EAAKM,EAAAA,IAAC4B,EAAK,CAAA,OAAQxB,GAAA,YAAAA,EAAU,OAAQ,SAAUA,GAAA,YAAAA,EAAU,QAAU,CAAA,EAAG,CACvG"}