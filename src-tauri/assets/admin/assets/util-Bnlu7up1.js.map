{"version":3,"file":"util-Bnlu7up1.js","sources":["../../../packages/admin/src/stores/projectStore.ts","../../../packages/admin/src/utils/util.ts"],"sourcesContent":["import { create } from 'zustand';\nimport _ from 'lodash-es';\nimport { IMenuItem } from '@/types/index';\n\nexport interface ProjectInfo {\n  id?: string;\n  footer?: number;\n  layout?: number;\n  logo?: string;\n  menuMode: 'inline' | 'horizontal' | 'vertical';\n  menuThemeColor?: string;\n  name: string;\n  systemThemeColor?: string;\n  breadcrumb?: boolean;\n  tag?: boolean;\n}\n\nexport interface PageState {\n  projectInfo: ProjectInfo;\n  collapsed: boolean;\n  menuTree: any[];\n  buttons: any[];\n  pageMap: { [key: string]: IMenuItem };\n  menuMap: { [key: string]: IMenuItem };\n}\n\nexport interface ProjectAction {\n  setProjectInfo: (payload: any) => void;\n  updateCollapsed: () => void;\n}\n\nexport const useProjectStore = create<PageState & ProjectAction>((set, get) => ({\n  projectInfo: {\n    name: '',\n    menuMode: 'inline',\n  },\n  collapsed: false,\n  menuTree: [],\n  buttons: [],\n  pageMap: {},\n  menuMap: {},\n  setProjectInfo: ({ projectInfo, menuTree, buttons, pageMap, menuMap }: any) => {\n    set({\n      projectInfo,\n      menuTree,\n      buttons,\n      pageMap,\n      menuMap,\n    });\n  },\n  updateCollapsed: () => {\n    set((state) => {\n      return {\n        collapsed: !state.collapsed,\n      };\n    });\n  },\n}));\n","import { IMenuItem } from '@/types/index';\n\n/**\n * 判断环境变量是否合法\n */\nexport function isEnv(env?: string) {\n  return env && ['stg', 'pre', 'prd'].includes(env);\n}\n/**\n * 获取页面ID\n * @param pageId 页面路径或者页面ID\n * @param pageMap 菜单映射对象\n * @returns\n */\nexport function getPageId(pageId: string, pageMap: Record<string, any>): string {\n  if (!pageId || !pageMap) return '';\n  const id = pageId !== 'welcome'\n    ? Object.values(pageMap).filter((item) => {\n      return item.path && item.path.startsWith('/') ? item.path.slice(1) === pageId : item.path === pageId;\n    })?.[0]?.pageId\n    : pageId;\n  return id;\n}\n/**\n * 菜单数据转换\n * treeList: 树形菜单\n * buttons: 按钮\n * pageMap: 页面ID映射\n * menuMap: 菜单ID映射\n * @returns\n */\nexport function arrayToTree(array: IMenuItem[] = []) {\n  const buttons: IMenuItem[] = [];\n  const pageMap: { [key: string]: Pick<IMenuItem, 'id' | 'pageId' | 'parentId' | 'name' | 'path'> } = {};\n  const menuMap: { [key: string]: IMenuItem } = {};\n  // 创建一个映射，将id映射到节点对象\n  const map: { [key: string]: IMenuItem & { children?: IMenuItem[] } } = {};\n  array.forEach((item) => {\n    map[item.id] = { ...item };\n    if (item.menuType === 2) buttons.push(item);\n    if (item.menuType === 1 || item.menuType === 3) {\n      if (item.pageId) {\n        pageMap[item.pageId] = { id: item.id, pageId: item.pageId, parentId: item.parentId, name: item.name, path: item.path };\n      } else {\n        menuMap[item.id] = { ...item };\n      }\n    }\n  });\n\n  // 找到每个节点的父节点\n  array.forEach((item) => {\n    if (item.parentId && map[item.parentId]) {\n      const parentItem = map[item.parentId];\n      if (item.menuType === 1 || item.menuType === 3) {\n        if (!parentItem.children) parentItem.children = [];\n        parentItem.children?.push(map[item.id]);\n        // 按照sortNum进行降序排序\n        parentItem.children = parentItem.children.sort((a, b) => a.sortNum - b.sortNum);\n      } else {\n        if (!parentItem.buttons) parentItem.buttons = [];\n        parentItem.buttons?.push(map[item.id]);\n      }\n    }\n  });\n  const menuTree = Object.values(map)\n    .filter((item) => !item.parentId)\n    .sort((a, b) => a.sortNum - b.sortNum);\n  return {\n    menuTree,\n    buttons,\n    pageMap,\n    menuMap,\n  };\n}\n"],"names":["useProjectStore","create","set","get","projectInfo","menuTree","buttons","pageMap","menuMap","state","getPageId","pageId","_b","_a","item","arrayToTree","array","map","parentItem","a","b"],"mappings":"wCA+BO,MAAMA,EAAkBC,EAAkC,CAACC,EAAKC,KAAS,CAC9E,YAAa,CACX,KAAM,GACN,SAAU,QACZ,EACA,UAAW,GACX,SAAU,CAAC,EACX,QAAS,CAAC,EACV,QAAS,CAAC,EACV,QAAS,CAAC,EACV,eAAgB,CAAC,CAAE,YAAAC,EAAa,SAAAC,EAAU,QAAAC,EAAS,QAAAC,EAAS,QAAAC,KAAmB,CACzEN,EAAA,CACF,YAAAE,EACA,SAAAC,EACA,QAAAC,EACA,QAAAC,EACA,QAAAC,CAAA,CACD,CACH,EACA,gBAAiB,IAAM,CACrBN,EAAKO,IACI,CACL,UAAW,CAACA,EAAM,SACpB,EACD,CAAA,CAEL,EAAE,EC3Cc,SAAAC,EAAUC,EAAgBJ,EAAsC,SAC9E,MAAI,CAACI,GAAU,CAACJ,EAAgB,GACrBI,IAAW,WAClBC,GAAAC,EAAA,OAAO,OAAON,CAAO,EAAE,OAAQO,GACxBA,EAAK,MAAQA,EAAK,KAAK,WAAW,GAAG,EAAIA,EAAK,KAAK,MAAM,CAAC,IAAMH,EAASG,EAAK,OAASH,CAC/F,IAFC,YAAAE,EAEG,KAFH,YAAAD,EAEO,OACPD,CAEN,CASgB,SAAAI,EAAYC,EAAqB,GAAI,CACnD,MAAMV,EAAuB,CAAC,EACxBC,EAA8F,CAAC,EAC/FC,EAAwC,CAAC,EAEzCS,EAAiE,CAAC,EAClE,OAAAD,EAAA,QAASF,GAAS,CACtBG,EAAIH,EAAK,EAAE,EAAI,CAAE,GAAGA,CAAK,EACrBA,EAAK,WAAa,GAAGR,EAAQ,KAAKQ,CAAI,GACtCA,EAAK,WAAa,GAAKA,EAAK,WAAa,KACvCA,EAAK,OACPP,EAAQO,EAAK,MAAM,EAAI,CAAE,GAAIA,EAAK,GAAI,OAAQA,EAAK,OAAQ,SAAUA,EAAK,SAAU,KAAMA,EAAK,KAAM,KAAMA,EAAK,IAAK,EAErHN,EAAQM,EAAK,EAAE,EAAI,CAAE,GAAGA,CAAK,EAEjC,CACD,EAGKE,EAAA,QAASF,GAAS,SACtB,GAAIA,EAAK,UAAYG,EAAIH,EAAK,QAAQ,EAAG,CACjC,MAAAI,EAAaD,EAAIH,EAAK,QAAQ,EAChCA,EAAK,WAAa,GAAKA,EAAK,WAAa,GACtCI,EAAW,WAAUA,EAAW,SAAW,CAAC,IACjDL,EAAAK,EAAW,WAAX,MAAAL,EAAqB,KAAKI,EAAIH,EAAK,EAAE,GAE1BI,EAAA,SAAWA,EAAW,SAAS,KAAK,CAACC,EAAGC,IAAMD,EAAE,QAAUC,EAAE,OAAO,IAEzEF,EAAW,UAASA,EAAW,QAAU,CAAC,IAC/CN,EAAAM,EAAW,UAAX,MAAAN,EAAoB,KAAKK,EAAIH,EAAK,EAAE,GACtC,CACF,CACD,EAIM,CACL,SAJe,OAAO,OAAOG,CAAG,EAC/B,OAAQH,GAAS,CAACA,EAAK,QAAQ,EAC/B,KAAK,CAACK,EAAGC,IAAMD,EAAE,QAAUC,EAAE,OAAO,EAGrC,QAAAd,EACA,QAAAC,EACA,QAAAC,CACF,CACF"}