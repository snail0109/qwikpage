import{a as M,u as v,r as p,j as e,c as C,R as w,C as N,O as k}from"./index-C0qVWane.js";import{u as b,g as L,a as A}from"./util-C1frwPKy.js";import{u as R,B as D,M as O,F as S,a as H,L as I,f as J,h as K}from"./index-DPKgr_Rt.js";import{i as W,R as X,a as Y}from"./index-BMEox4u4.js";import{l as G}from"./zh-cn-7uF_JMsI.js";import"./index-DfNzS1Q2.js";import"./MinusOutlined-DBQl31A9.js";import"./RedoOutlined-B23EvFCt.js";const Q="_logo_145u9_1",U="_logoName_145u9_14",T={logo:Q,logoName:U};function $(){const{collapsed:o,projectInfo:t}=b(),n=M(),{projectId:i}=v(),[r,u]=p.useState({}),[a,m]=p.useState({});return p.useEffect(()=>{t.menuThemeColor==="dark"?u({backgroundColor:"#001529",color:"#fff",height:64,padding:"10px 20px"}):u({backgroundColor:"#fff",color:"#000",height:64,padding:"10px 20px"}),/^[\u4e00-\u9fa5]+$/.test(t.name)&&m({fontSize:t.name.length>9?14:16})},[t.layout,t.menuThemeColor]),e.jsxs("div",{className:T.logo,onClick:()=>{n(`/project/${i}/welcome`)},style:r,children:[e.jsx("img",{src:t.logo||"/imgs/mars-logo.png"}),!o&&e.jsx("span",{className:T.logoName,style:a,children:t.name})]})}function z(){const{projectId:o}=v(),[t,n]=p.useState([]),{pathname:i}=C(),{pageMap:r,menuMap:u}=b(R(a=>({pageMap:a.pageMap,menuMap:a.menuMap})));return p.useEffect(()=>{if(!o)return;const a=i.split(o)[1].slice(1),m=L(a,r);if(!m)return;const h=r[m];if(i.endsWith("/welcome")){n([{title:"欢迎页"}]);return}if(!h)return;const d=[];let g=h;for(;g;)d.unshift({title:g.name}),g=u[g.parentId];n(d)},[i,u]),e.jsx(D,{className:"layout-bread-crumb",items:t})}const B=()=>{const[o,t]=p.useState([]),[n,i]=p.useState([]),r=M(),{pathname:u}=C(),{projectId:a}=v(),{collapsed:m,menuTree:h,projectInfo:d}=b();p.useEffect(()=>{const l=g(h);t(l)},[h]),p.useEffect(()=>{i([u])},[u]);const g=(l,f=[])=>(l.forEach(s=>{var j;if(s.menuType===1&&s.status===1){const y=W;if((j=s.buttons)!=null&&j.length||!s.children){const q=`/project/${a}/${s.path&&s.path.startsWith("/")?s.path.slice(1):s.path||s.pageId}`;return f.push(x(s.name,q,y[s.icon]&&w.createElement(y[s.icon])))}const F=`${a}-${s.id}`;f.push(x(s.name,F,y[s.icon]&&w.createElement(y[s.icon]),g(s.children||[])))}}),f);function x(l,f,s,j,y){return(j==null?void 0:j.length)===0&&(j=void 0),{key:f,icon:s,children:j,label:l,type:y}}const c=l=>{const f=l.key;u!==f&&(l.key.split("/").slice(-1)[0]==="0"?r("notPublish"):r(f))};return e.jsx("div",{style:d.menuMode==="horizontal"?{width:"calc(100vw - 458px)"}:{width:m?79:255,background:d.menuThemeColor==="light"?"#fff":"#001529",borderRight:d.layout===2?"1px solid #e8e9eb":"none",overflowX:"hidden"},children:e.jsx(N,{theme:{components:{Menu:{darkItemColor:"#fff",darkItemHoverColor:d.systemThemeColor,iconSize:16}}},children:e.jsx(O,{onClick:c,theme:d.menuThemeColor,selectedKeys:n,style:d.menuMode==="horizontal"?{}:{height:"calc(100vh - 64px)",border:"none",overflowY:"auto"},mode:d.menuMode,inlineCollapsed:d.menuMode==="horizontal"?void 0:m,items:o})})})},V="_header_1imqu_1",Z="_menu_1imqu_16",ee="_user_1imqu_22",te="_publishPopover_1imqu_26",oe={header:V,menu:Z,user:ee,publishPopover:te},P=p.memo(()=>{const{projectInfo:o,collapsed:t,updateCollapsed:n}=b(),i=()=>{n()},r=o.menuThemeColor==="light"||o.layout===1,u={backgroundColor:r?"#fff":"#001529",color:o.menuThemeColor==="light"?"#000":"#fff"};return e.jsxs("div",{className:oe.header,style:u,children:[o.layout===1?e.jsxs(S,{align:"center",children:[e.jsx("div",{onClick:i,style:{cursor:"pointer"},children:t?e.jsx(X,{style:{color:r?"#000":"#fff"}}):e.jsx(Y,{style:{color:r?"#000":"#fff"}})}),o.breadcrumb&&e.jsx(z,{})]}):null,o.layout===2?e.jsxs(S,{align:"center",children:[e.jsx($,{}),e.jsx(B,{})]}):null]})});function _(){const o=M(),[t,n]=p.useState([{label:"欢迎页",key:"welcome",closable:!1}]),[i,r]=p.useState(""),{projectId:u}=v(),{pathname:a}=C(),m=b(R(c=>c.pageMap));p.useEffect(()=>{h()},[a,m]);const h=()=>{if(!u)return;const c=a.split(u)[1].slice(1),l=L(c,m),f=m[l];f&&(t.find(s=>s.key.includes(a))||t.push({key:a+location.search,label:f.name,closable:!0}),n([...t]),r(a+location.search))},d=c=>{a===c&&t.forEach((l,f)=>{if(l.key!=a)return;const s=t[f+1]||t[f-1];s&&o(s.key)}),n(t.filter(l=>l.key!=c))},g=c=>{d(c)},x=c=>{if(r(c),c==="welcome")return o("welcome");o(c)};return e.jsx(H,{type:"editable-card",hideAdd:!0,activeKey:i,items:t,onChange:x,onEdit:g,tabBarStyle:{marginBottom:0,backgroundColor:"#fff",paddingTop:10}})}const E={set(o,t){localStorage.setItem(o,JSON.stringify(t))},get(o){const t=localStorage.getItem(o);if(!t)return"";try{return JSON.parse(t)}catch{return""}},remove(o){localStorage.removeItem(o)},clear(){localStorage.clear()}},de=()=>{const{collapsed:o,setProjectInfo:t,projectInfo:n}=b(h=>({collapsed:h.collapsed,setProjectInfo:h.setProjectInfo,projectInfo:h.projectInfo})),i=M(),{projectId:r}=v(),{pathname:u}=C();p.useEffect(()=>{(async()=>{if(r){const d=await J(r).catch(()=>i("/403?type=project"));if(!d.id)return i("/404?type=project");const g=await K(r).catch(()=>i("/403?type=project"));if(!g)return;/project\/\d+\/\w+/.test(u)||i(`/project/${r}/welcome`);const{menuTree:x,buttons:c,pageMap:l,menuMap:f}=A(g||[]);E.set("buttons",c),E.set("pageMap",l),t({projectInfo:d,menuTree:x,buttons:c,pageMap:l,menuMap:f})}})()},[r]);const a=p.useMemo(()=>n.tag?"calc(100vh - 114px)":"calc(100vh - 64px)",[n.tag]),m=()=>e.jsx(I.Footer,{children:e.jsx("div",{className:"footnote",children:e.jsx("span",{children:"Copyright © 2024 Marsview. All Rights Reserved. "})})});return e.jsx(N,{locale:G,theme:{token:{colorPrimary:n.systemThemeColor||"#1677ff"},hashed:!1},children:e.jsxs(I,{children:[n.layout===1&&e.jsxs(I,{style:{flexDirection:"row"},children:[e.jsxs("div",{style:{width:o?80:256,borderRight:"1px solid #e8e9eb"},children:[e.jsx($,{}),e.jsx(B,{})]}),e.jsxs("div",{style:{width:o?"calc(100vw - 80px)":"calc(100vw - 256px)"},children:[e.jsx(P,{}),n.tag&&e.jsx(_,{}),e.jsxs("div",{style:{height:a,overflow:"auto"},children:[e.jsx(k,{}),n.footer===1&&e.jsx(m,{})]})]})]}),n.layout===2&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),n.tag?e.jsx(_,{}):null,e.jsxs(I,{style:{padding:20,backgroundColor:"#f3f5f9",height:a,overflow:"auto"},children:[n.breadcrumb&&e.jsx(z,{}),e.jsx(k,{}),n.footer===1&&e.jsx(m,{})]})]})]})})};export{de as default};
