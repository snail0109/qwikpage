{"version":3,"file":"CountDown-DkOyH63I.js","sources":["../../../packages/materials/Basic/CountDown/CountDown.tsx"],"sourcesContent":["import React, { useState, useEffect, useImperativeHandle, forwardRef } from 'react';\nimport { Statistic } from 'antd';\nimport { ComponentType } from '@materials/types';\nimport * as icons from '@ant-design/icons';\nimport { message } from '@materials/utils/AntdGlobal';\nimport { omit } from 'lodash-es';\n/**\n *\n * @param props 组件本身属性\n * @param style 组件样式\n * @returns\n */\nconst CountDown = ({ config, onChange, onFinish }: ComponentType, ref: any) => {\n  const [text, setText] = useState(0);\n  const [visible, setVisible] = useState(true);\n\n  useEffect(() => {\n    if (isNaN(config.props?.value)) {\n      console.error('倒计时组件值必须为时间戳类型');\n      message.error('倒计时组件值必须为时间戳');\n      return;\n    }\n    const originText = config.props?.value?.toString() || '';\n    const script = config.props?.script;\n    let value: string | number = originText;\n\n    if (script) {\n      try {\n        const renderFn = new Function('value', `return (${script})(value);`);\n        value = renderFn(value);\n      } catch (error) {\n        console.error(`脚本解析失败`, error);\n        message.error(JSON.stringify(error));\n      }\n    }\n    setText(Number(value?.toString()));\n  }, [config.props.value, config.props?.script]);\n\n  // 对外暴露方法\n  useImperativeHandle(ref, () => {\n    return {\n      show() {\n        setVisible(true);\n      },\n      hide() {\n        setVisible(false);\n      },\n    };\n  });\n\n  const iconsList: { [key: string]: any } = icons;\n  return (\n    visible && (\n      <Statistic.Countdown\n        style={config.style}\n        {...omit(config.props, ['script', 'format', 'prefix', 'suffix'])}\n        value={text}\n        format={config.props?.format || undefined}\n        prefix={config.props.prefix ? React.createElement(iconsList[config.props.prefix]) : null}\n        suffix={config.props.suffix ? React.createElement(iconsList[config.props.suffix]) : null}\n        onChange={(val) => onChange?.(val)}\n        onFinish={() => onFinish?.(text)}\n      />\n    )\n  );\n};\nexport default forwardRef(CountDown);\n"],"names":["CountDown","config","onChange","onFinish","ref","text","setText","useState","visible","setVisible","useEffect","_a","message","originText","_c","_b","script","_d","value","error","useImperativeHandle","iconsList","icons","jsx","Statistic","omit","React","val","forwardRef"],"mappings":"8SAYA,MAAMA,EAAY,CAAC,CAAE,OAAAC,EAAQ,SAAAC,EAAU,SAAAC,CAAA,EAA2BC,IAAa,SAC7E,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,CAAC,EAC5B,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAE3CG,EAAAA,UAAU,IAAM,aACd,GAAI,OAAMC,EAAAV,EAAO,QAAP,YAAAU,EAAc,KAAK,EAAG,CAC9B,QAAQ,MAAM,gBAAgB,EAC9BC,EAAQ,MAAM,cAAc,EAC5B,MAAA,CAEF,MAAMC,IAAaC,GAAAC,EAAAd,EAAO,QAAP,YAAAc,EAAc,QAAd,YAAAD,EAAqB,aAAc,GAChDE,GAASC,EAAAhB,EAAO,QAAP,YAAAgB,EAAc,OAC7B,IAAIC,EAAyBL,EAE7B,GAAIG,EACE,GAAA,CAEFE,EADiB,IAAI,SAAS,QAAS,WAAWF,CAAM,WAAW,EAClDE,CAAK,QACfC,EAAO,CACN,QAAA,MAAM,SAAUA,CAAK,EAC7BP,EAAQ,MAAM,KAAK,UAAUO,CAAK,CAAC,CAAA,CAGvCb,EAAQ,OAAOY,GAAA,YAAAA,EAAO,UAAU,CAAC,CAAA,EAChC,CAACjB,EAAO,MAAM,OAAOU,EAAAV,EAAO,QAAP,YAAAU,EAAc,MAAM,CAAC,EAG7CS,EAAA,oBAAoBhB,EAAK,KAChB,CACL,MAAO,CACLK,EAAW,EAAI,CACjB,EACA,MAAO,CACLA,EAAW,EAAK,CAAA,CAEpB,EACD,EAED,MAAMY,EAAoCC,EAC1C,OACEd,GACEe,EAAA,IAACC,EAAU,UAAV,CACC,MAAOvB,EAAO,MACb,GAAGwB,EAAKxB,EAAO,MAAO,CAAC,SAAU,SAAU,SAAU,QAAQ,CAAC,EAC/D,MAAOI,EACP,SAAQU,EAAAd,EAAO,QAAP,YAAAc,EAAc,SAAU,OAChC,OAAQd,EAAO,MAAM,OAASyB,EAAM,cAAcL,EAAUpB,EAAO,MAAM,MAAM,CAAC,EAAI,KACpF,OAAQA,EAAO,MAAM,OAASyB,EAAM,cAAcL,EAAUpB,EAAO,MAAM,MAAM,CAAC,EAAI,KACpF,SAAW0B,GAAQzB,GAAA,YAAAA,EAAWyB,GAC9B,SAAU,IAAMxB,GAAA,YAAAA,EAAWE,EAAI,CACjC,CAGN,EACeuB,EAAAA,EAAAA,WAAW5B,CAAS"}